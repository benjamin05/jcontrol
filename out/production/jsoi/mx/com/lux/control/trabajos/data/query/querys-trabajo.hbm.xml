<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Mapping file autogenerated by Alberto -->
<hibernate-mapping package="data">

	<query name="findJbById"> 
		<![CDATA[ 
			FROM Jb t
			LEFT JOIN FETCH t.estado
			WHERE t.rx = :rxParam
		 ]]>
	</query>

	<query name="findLastEstadoByLlamadaNA">
		SELECT jt.estado FROM JbTrack jt
		WHERE jt.rx = ?
		AND jt.estado != 'TE'
		AND jt.estado not in (SELECT je.idEdo from JbEstado je where je.llamada='NA')
		ORDER BY jt.fecha desc
	</query>

	<query name="findJbLlamadaById"> 
		<![CDATA[ 
			FROM JbLlamada jbl
			WHERE jbl.rx = :rxParam
		 ]]>
	</query>

	<query name="findJbGrupoById"> 
		<![CDATA[ 
			FROM JbGrupo t
			LEFT JOIN FETCH t.estado
			WHERE t.idGrupo = :idParam
		 ]]>
	</query>

	<query name="findJbFromJbGrupoDetalleByIdGrupo"> 
		<![CDATA[ 
			FROM Jb jb1
			WHERE jb1.rx in (
				SELECT jbgd.id.rx 
				FROM JbGrupoDetalle jbgd  
				WHERE jbgd.id.idGrupo = :idParam)
		 ]]>
	</query>


	<query name="findJbGrupoDetalleByIdGrupo"> 
		<![CDATA[ 
			FROM JbGrupoDetalle jbgd
			LEFT JOIN FETCH jbgd.jb djb
			LEFT JOIN FETCH djb.estado
			WHERE jbgd.id.idGrupo = :idParam
		 ]]>
	</query>

	<query name="countJbGrupoDetalleByIdGrupo"> 
		<![CDATA[ 
			SELECT COUNT (*) 
			FROM JbGrupoDetalle jbgd
			WHERE jbgd.id.idGrupo = :idParam
		 ]]>
	</query>

	<query name="findGParametroById"> 
		<![CDATA[ 
			FROM GParametro gp
			WHERE gp.idParametro = :gpParam
		 ]]>
	</query>

	<query name="findTable_jbByFilters"> 
		<![CDATA[ 
			FROM Jb t
			LEFT JOIN FETCH t.estado
			WHERE
				t.estado.idEdo LIKE :estadoParam AND
				t.rx LIKE :rxParam AND
				t.cliente LIKE :clienteParam AND
				t.empAtendio LIKE :atendioParam
			ORDER BY 
			t.rx, t.cliente, t.fechaPromesa, t.empAtendio
		 ]]>
	</query>

	<query name="findAllTable_jb"> 
		<![CDATA[ 
			FROM Jb t
		 ]]>
	</query>

	<query name="findAllJbByEdosAndFecha"> 
		<![CDATA[ 
			SELECT j, jbt 
			FROM Jb j, JbTrack jbt
			WHERE j.rx = jbt.rx
			AND jbt.estado IN ('RS','RPE')
			AND date(jbt.fecha) = current_date
			order by jbt.fecha desc
		 ]]>
	</query>

	<query name="findAllTrackViewByRx"> 
		<![CDATA[ 
			FROM TrackView tv
			WHERE tv.id.rx = :rxParam
			ORDER BY fecha DESC
		 ]]>
	</query>

	<query name="countAllTrackViewByRx"> 
		<![CDATA[
			SELECT COUNT(*)
			FROM TrackView tv
				WHERE tv.id.rx = :rxParam
		 ]]>
	</query>

	<query name="findNominaByFactura"> 
		<![CDATA[ 
			FROM Nomina n
			WHERE n.id.factura = :rxParam
		 ]]>
	</query>


	<query name="findRecetaIdByFactura"> 
		<![CDATA[ 
			SELECT nv.receta FROM NotaVenta nv
			WHERE nv.factura = :rxParam
		 ]]>
	</query>

	<query name="findJbNoEnviar">
		SELECT jb FROM Jb jb WHERE jb.estado IN ('NE','RNE')
	</query>

	<query name="findJbPorEnviar">
		SELECT jb FROM Jb jb WHERE jb.estado IN ('PE','RPE')
	</query>

	<query name="countJbNoEnviar">
		SELECT count(jb.rx) FROM Jb jb WHERE jb.estado IN
		('NE','RNE')
	</query>

	<query name="countJbPorEnviar">
		SELECT count(jb.rx) FROM Jb jb WHERE jb.estado IN
		('PE','RPE')
	</query>

	<query name="findByJbTipo">
		SELECT jb FROM Jb jb WHERE jb.jbTipo = ? AND
		jb.estado IN ('PE','RPE') AND NOT EXISTS (select js.rx
		from JbSobre js
		where js.rx = jb.rx
        and js.fechaEnvio = null) ORDER BY jb.rx
	</query>

    <query name="buscarPorEnviarLaboratorio">
        SELECT jb FROM Jb jb WHERE jb.jbTipo = 'LAB' AND
        jb.estado IN ('PE','RPE') AND NOT EXISTS (select js.rx
        from JbSobre js
        where js.rx = jb.rx and js.fechaEnvio = null) ORDER BY jb.rx
    </query>

	<query name="findByJbEstado">
		SELECT jb FROM Jb jb WHERE jb.estado.idEdo = ? ORDER
		BY jb.rx
	</query>

	<query name="findJbDevByFechaEnvioNull">
		SELECT jd FROM JbDev jd WHERE jd.id.fechaEnvio IS
		NULL ORDER BY jd.id.factura
	</query>

	<query name="findJbTrackByRxAndEstado"> 
		<![CDATA[ 
			FROM JbTrack jt
			WHERE jt.rx = ?
			AND jt.estado = ? ORDER BY jt.fecha
		 ]]>
	</query>

	<query name="findJbTrackByRx"> 
		<![CDATA[ 
			FROM JbTrack jt
			WHERE jt.rx = ? ORDER BY jt.fecha DESC
		 ]]>
	</query>

	<query name="findAllEmpresaFicha"> 
		<![CDATA[ 
			FROM EmpresaFicha ef
			ORDER BY ef.descripcion
		 ]]>
	</query>

	<query name="findAllParentescoFichas"> 
		<![CDATA[ 
			FROM ParentescoFichas pf
			ORDER BY pf.descripcion
		 ]]>
	</query>

	<!-- DETALLE NOTA VENTA -->

	<query name="findDetNotaVenByIdArt">
		<![CDATA[ 
			FROM DetalleNotaVenta dnv
			WHERE dnv.idFactura = :idFacturaParam
		 ]]>
	</query>

	<query name="findDetNotaVenByIdArtSurteAndGenerico">
		<![CDATA[ 
			FROM DetalleNotaVenta dnv
			WHERE dnv.idFactura = :idFacturaParam 
			AND dnv.surte = :surteParam 
			AND exists (FROM Articulos a WHERE a.idArticulo = dnv.idArticulo AND a.idGenerico = :genericoParam)
		 ]]>
	</query>

	<!-- ARTICULOS -->

	<query name="findArticulosByArt">
		<![CDATA[ 
			FROM Articulos a
			WHERE a.idArticulo = :idArticuloParam
		 ]]>
	</query>

	<query name="findArticuloByIdArtAndIdGeneric">
		<![CDATA[ 
			FROM Articulos a
			WHERE a.idArticulo = :idArticuloParam
			AND a.idGenerico = :genericoParam
		 ]]>
	</query>

	<!-- PAGOS -->

	<query name="findPagosByIdFactura">
		<![CDATA[ 
			FROM Pagos p
			WHERE p.idFactura = :idFacturaParam
		 ]]>
	</query>

	<!-- POLIZAS -->

	<query name="findPolizasByFacturaVenta">
		<![CDATA[ 
			FROM Polizas p
			WHERE p.facturaVenta = :facturaVentaParam
		 ]]>
	</query>

	<query name="findMaxNotaFacturaByFactura">
		<![CDATA[ 
			FROM NotaFactura nf
			WHERE nf.idFiscal IN (SELECT MAX(nfsub.idFiscal) FROM NotaFactura nfsub WHERE nfsub.factura = ?)
		 ]]>
	</query>

	<!-- DEVOLUCIONES -->

	<query name="findAllDoctoInvByTipoAndEstado">
		<![CDATA[ 
			FROM DoctoInv di
			WHERE di.idTipoDocto = :tipoParam
			AND di.estado = :estadoParam
		 ]]>
	</query>

	<!-- CAJAS -->

	<query name="findCajaByIdCaja">
		<![CDATA[ 
			FROM Cajas c
			WHERE c.idCaja = :idParam
		 ]]>
	</query>

	<!-- JB_ROTOS -->

	<query name="findLastJbRotoByRx">
		<![CDATA[
			FROM JbRoto jbr
			WHERE jbr.rx = :rxParam
			ORDER BY jbr.numRoto DESC
		 ]]>
	</query>

	<!-- REP -->

	<query name="getAllEstadoRepublica">
		<![CDATA[
			FROM EstadoRepublica er
			ORDER BY er.nombre
		 ]]>
	</query>

	<!-- MUNICI -->

	<query name="findAllDelMunByIdEstadoAndLocalidad">
		<![CDATA[
			FROM Municipio m
			WHERE m.id.idEstado LIKE :estadoParam
			AND m.id.idLocalidad LIKE :localidadParam
			ORDER BY m.nombre
		 ]]>
	</query>

	<!-- CODIGO -->

	<query name="findAllCodigoByIdEstadoAndLocalidad">
		<![CDATA[
			FROM Codigo c
			WHERE c.id.idEstado LIKE :estadoParam
			AND c.id.idLocalidad LIKE :localidadParam			
			ORDER BY c.id.usuario
		 ]]>
	</query>

	<query name="findAllCodigoByCodigo">
		<![CDATA[
			FROM Codigo c
			WHERE c.id.codigo = :codigoParam			
			ORDER BY c.id.usuario
		 ]]>
	</query>

	<!-- DOMINIO -->

	<query name="getAllDominios">
		<![CDATA[
			FROM Dominios d
			ORDER BY d.nombre
		 ]]>
	</query>

</hibernate-mapping>
